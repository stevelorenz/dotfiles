# vim: set sw=4 ts=4 sts=4 et tw=100 foldmarker={,} foldlevel=0 foldmethod=marker:
# ===========================
# About: Tmux Configuration File
# Maintainer: Xiang, Zuo
# Email: xianglinks@gmail.com
# Sections:
#    -> General
#    -> Mode
#    -> Windows
#    -> Panes
#    -> Custom Looks
#    -> Plugins
# ===========================

# --- General ------------------------------------------------------------------ {

# set 256 colors
set -g default-terminal "screen-256color"

# enable shell hotkeys c-left/c-right
setw -g xterm-keys on

# fast command sequences
set -s escape-time 0
set -sg repeat-time 600

# use ctrl-a as compatible prefix
set -g prefix2 C-a
bind C-a send-prefix -2

# set default shell
#set-option -g default-command /bin/bash
#set-option -g default-shell /bin/bash
set-option -g default-command /bin/zsh
set-option -g default-shell /bin/zsh

# boost history
set -g history-limit 5000

# reload configuration
bind r source-file ~/.tmux.conf \; display '~/.tmux.conf sourced'

# enable mouse control (clickable windows, panes, resizable panes)
set-option -g mouse on

# redraw status line every 10 seconds
set -g status-interval 10

# 24 hour clock
setw -g clock-mode-style 24

# vi keys in command prompt
set-option -g status-keys vi

## copy mode {
bind Enter copy-mode  # enter copy mode
# vi keys in copy mode
set-window-option -g mode-keys vi

# bind keys for different versions
run-shell "tmux setenv -g TMUX_VERSION $(tmux -V | cut -c 6-)"
if-shell -b '[ "$(echo "$TMUX_VERSION < 2.4" | bc)" = 1 ]' \
  "bind-key Escape copy-mode; \
  bind-key -t vi-copy Escape cancel; \
  bind-key p paste-buffer; \
  bind-key -t vi-copy v begin-selection; \
  bind-key -t vi-copy V select-line; \
  bind-key -t vi-copy r rectangle-toggle; \
  bind -t vi-copy y copy-pipe 'xclip -in -selection clipboard'"

if-shell -b '[ "$(echo "$TMUX_VERSION >= 2.4" | bc)" = 1 ]' \
  "bind-key -T copy-mode-vi 'v' send -X begin-selection; \
  bind-key -T copy-mode-vi 'V' send -X select-line; \
  bind-key -T copy-mode-vi 'r' send -X rectangle-toggle; \
  bind-key -T copy-mode-vi 'y' send -X copy-pipe-and-cancel 'xclip -in -selection clipboard'"
## }

# }

# --- Windows ------------------------------------------------------------------ {

# window number starts with 1
set-option -g base-index 1

bind-key t next-window
bind-key T previous-window

# stop rename window automatically
setw -g automatic-rename off
set-option -g allow-rename off

# renumber windows when a window is closed
set -g renumber-windows on

# swap window location
# single step left and right
bind-key S-Left swap-window -t -1
bind-key S-Right swap-window -t +1

# new window with the current path (tmux 1.9+)
bind-key c new-window -c "#{pane_current_path}"

# }

# --- Panes -------------------------------------------------------------------- {

setw -g pane-base-index 1  # panel number start with 1

# switching panels use vim-mode
unbind-key h
bind-key h select-pane -L
unbind-key j
bind-key j select-pane -D
unbind-key k
bind-key k select-pane -U
unbind-key l
bind-key l select-pane -R

# resize panes using prefix
bind H resize-pane -L 5
bind J resize-pane -D 5
bind K resize-pane -U 5
bind L resize-pane -R 5

# }

# --- Custom Looks  ------------------------------------------------------------ {

## status bar {

# use quiet mode
set-option -g visual-activity off
set-option -g visual-bell off
set-option -g visual-silence off
set-window-option -g monitor-activity off
set-option -g bell-action none

set -g status-justify centre
set -g status-bg default
set -g status-fg colour12
set -g status-interval 2

set -g status-position bottom
set -g status-bg colour234
set -g status-fg colour137
set -g status-attr dim
set -g status-left '#[fg=green]#S #[fg=yellow]#I #[fg=cyan]#P'
set -g status-right '#[fg=green] | %H:%M | #[fg=green]%a %D'
set -g status-right-length 50
set -g status-left-length 20

# messaging
set -g message-attr bold
set -g message-fg colour232
set -g message-bg colour166
set -g message-command-fg blue
set -g message-command-bg black

# window mode
setw -g mode-bg colour6
setw -g mode-fg colour0

# window status
setw -g window-status-format " #F#I:#W#F "
setw -g window-status-current-format " #F#I:#W#F "
setw -g window-status-format "#[fg=magenta]#[bg=black] #I #[bg=cyan]#[fg=colour8] #W "
setw -g window-status-current-format "#[bg=brightmagenta]#[fg=colour8] #I #[fg=colour8]#[bg=colour14] #W "
setw -g window-status-current-bg colour0
setw -g window-status-current-fg colour11
setw -g window-status-current-attr dim
setw -g window-status-bg green
setw -g window-status-fg black
setw -g window-status-attr reverse

setw -g clock-mode-colour colour135
setw -g mode-attr bold
setw -g mode-fg colour196
setw -g mode-bg colour238

set -g pane-border-bg colour235
set -g pane-border-fg colour238
set -g pane-active-border-bg colour236
set -g pane-active-border-fg colour51

# current selected window
setw -g window-status-current-fg colour81
setw -g window-status-current-bg colour238
setw -g window-status-current-attr bold
setw -g window-status-current-format ' #I#[fg=colour250]:#[fg=colour255]#W#[fg=colour50]#F '

# inactive windows
setw -g window-status-fg colour138
setw -g window-status-bg colour235
setw -g window-status-attr none
setw -g window-status-format ' #I#[fg=colour237]:#[fg=colour250]#W#[fg=colour244]#F '

setw -g window-status-bell-attr bold
setw -g window-status-bell-fg colour255
setw -g window-status-bell-bg colour1

# }

## windows {
## }

## panes {
set -g pane-border-fg black
set -g pane-active-border-fg brightred
## }


# }

# --- Plugins ----------------------------------------------------------------- {
# all plugins are managed by tmux-tpm
# plugins are loaded only when tpm is installed
# the default path of tpm: ~/.tmux/plugins/tpm/

# tmux plugins manager (tpm)
set -g @plugin 'tmux-plugins/tpm'
  # -- Installing plugins --
     # Add new plugin to ~/.tmux.conf with set -g @plugin '...'
     # Press prefix + I (capital I, as in Install) to fetch the plugin.

  # -- Update plugins ---
     # prefix + U

  # -- Remove plugins --
     # Remove (or comment out) plugin from the list.
     # Press prefix + alt + u (lowercase u as in uninstall) to remove the plugin.

# sensible settings
set -g @plugin 'tmux-plugins/tmux-sensible'

# support scroll with mouse and copy mode
set -g @plugin 'nhdaly/tmux-scroll-copy-mode'

# using system clipboard
set -g @plugin 'tmux-plugins/tmux-yank'
# copy mode bindings:
# y - copy selection to system clipboard
# Y (shift-y) - "put" selection - equivalent to copying a selection, and pasting it to the command line

# persists tmux environment across system restarts
set -g @plugin 'tmux-plugins/tmux-resurrect'
  # prefix + Ctrl-s - save current env
  # prefix + Ctrl-r - restore last env

# a plugin that enhances tmux search
set -g @plugin 'tmux-plugins/tmux-copycat'

# init tmux plugin manager (keep this line at the very bottom of tmux.conf)
# if-shell "[[ -d ~/.tmux/plugins/ ]]" 'run '~/.tmux/plugins/tpm/tpm''
#run '~/.tmux/plugins/tpm/tpm'
if '[ -d ~/.tmux/plugins/tpm/]' '~/.tmux/plugins/tpm/tpm'

# }
